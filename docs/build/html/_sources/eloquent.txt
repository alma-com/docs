Eloquent ORM
==========

Система объектно-реляционного отображения (ORM) Eloquent — красивая и простая реализация шаблона `ActiveRecord`_ для работы с базами данных. 
Каждая таблица имеет соответствующий класс-модель, который используется для работы с этой таблицей.


Основы использования
-------------------------

Для начала создадим модель Eloquent. Модели располагаются в папке ``app\models``. Все модели Eloquent наследуют базовый класс ``eloquent`` и инициализируют переменную ``$_table`` с названием таблицы.

Пример создание модели:
::

	@CLASS
	role

	@BASE
	eloquent
	
	@auto[]
	$_table[roles]

Когда модель определена, у вас всё готово для того, чтобы можно было выбирать и создавать записи.



Методы Eloquent
-------------------------

.. function:: @all[]	
	
	Получение всех записей модели.
	::

		$roles[^role:all[]]
	
.. function:: @find[string $id]	
	
	Получение записи по любому уникальному полю.
	::

		$roles[^role:find[1]]
	
.. function:: @new[]	
	
	Создание нового объекта модели.
	::

		$roles[^role:new[]]

.. function:: @sql[]	
	
	Выполнение произвольного sql запроса. ``%TABLE%`` - название таблицы, ``%KEY%`` - ключ таблицы.
	::

		$roles[^role:sql[SELECT %KEY% FROM %TABLE% LIMIT 2]]

		
.. function:: @save[]	
	
	Сохранение данных в БД (только динамический вызов).
	::

		$roles[^role.save[]]
	
.. function:: @delete[]	
	
	Удаление данных из БД (только динамический вызов).
	::

		$roles[^role.delete[]]




	
Пример сохранения новой записи
~~~~~~~~~~~~~
::

	$roles[^role:new[]]
	$roles.name[Администратор]
	$roles[^role.save[]]
	
	
Пример обновления записи
~~~~~~~~~~~~~
::

	$roles[^role:find[1]]
	$roles.name[Терминатор]
	$roles[^role.save[]]
	
	
Пример удаление записи
~~~~~~~~~~~~~
::

	$roles[^role:find[1]]
	^role.delete[]
	
	

Модель любой таблицы
-------------------------	

Класс Eloquent позволяет обращаться к любой таблице без создания дополнительных классов.
::

	^eloquent:connect[roles]
	$roles[^eloquent:all[]]
	^eloquent:close[]
	
Метод ``connect`` устанавливает соединение с таблицей, с которой Eloquent должен работать. В конце необходимо вызвать метод ``clear``, для того чтобы удалить соединение с таблицей.


.. _`ActiveRecord`: https://ru.wikipedia.org/w/index.php?title=Special:Search&search=ActiveRecord